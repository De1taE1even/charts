--- charts-original/templates/_pod.tpl
+++ charts/templates/_pod.tpl
@@ -4,13 +4,13 @@
 {{- end }}
 serviceAccountName: {{ template "grafana.serviceAccountName" . }}
 automountServiceAccountToken: {{ .Values.serviceAccount.autoMount }}
-{{- with .Values.securityContext }}
+{{- if .Values.securityContext }}
 securityContext:
-  {{- toYaml . | nindent 2 }}
+{{ toYaml .Values.securityContext | indent 2 }}
 {{- end }}
-{{- with .Values.hostAliases }}
+{{- if .Values.hostAliases }}
 hostAliases:
-  {{- toYaml . | nindent 2 }}
+{{ toYaml .Values.hostAliases | indent 2 }}
 {{- end }}
 {{- if .Values.priorityClassName }}
 priorityClassName: {{ .Values.priorityClassName }}
@@ -21,19 +21,17 @@
 {{- if ( and .Values.persistence.enabled .Values.initChownData.enabled ) }}
   - name: init-chown-data
     {{- if .Values.initChownData.image.sha }}
-    image: "{{ .Values.initChownData.image.repository }}:{{ .Values.initChownData.image.tag }}@sha256:{{ .Values.initChownData.image.sha }}"
+    image: "{{ template "system_default_registry" . }}{{ .Values.initChownData.image.repository }}:{{ .Values.initChownData.image.tag }}@sha256:{{ .Values.initChownData.image.sha }}"
     {{- else }}
-    image: "{{ .Values.initChownData.image.repository }}:{{ .Values.initChownData.image.tag }}"
+    image: "{{ template "system_default_registry" . }}{{ .Values.initChownData.image.repository }}:{{ .Values.initChownData.image.tag }}"
     {{- end }}
     imagePullPolicy: {{ .Values.initChownData.image.pullPolicy }}
     securityContext:
       runAsNonRoot: false
       runAsUser: 0
     command: ["chown", "-R", "{{ .Values.securityContext.runAsUser }}:{{ .Values.securityContext.runAsGroup }}", "/var/lib/grafana"]
-    {{- with .Values.initChownData.resources }}
     resources:
-      {{- toYaml . | nindent 6 }}
-    {{- end }}
+{{ toYaml .Values.initChownData.resources | indent 6 }}
     volumeMounts:
       - name: storage
         mountPath: "/var/lib/grafana"
@@ -44,26 +42,20 @@
 {{- if .Values.dashboards }}
   - name: download-dashboards
     {{- if .Values.downloadDashboardsImage.sha }}
-    image: "{{ .Values.downloadDashboardsImage.repository }}:{{ .Values.downloadDashboardsImage.tag }}@sha256:{{ .Values.downloadDashboardsImage.sha }}"
+    image: "{{ template "system_default_registry" . }}{{ .Values.downloadDashboardsImage.repository }}:{{ .Values.downloadDashboardsImage.tag }}@sha256:{{ .Values.downloadDashboardsImage.sha }}"
     {{- else }}
-    image: "{{ .Values.downloadDashboardsImage.repository }}:{{ .Values.downloadDashboardsImage.tag }}"
+    image: "{{ template "system_default_registry" . }}{{ .Values.downloadDashboardsImage.repository }}:{{ .Values.downloadDashboardsImage.tag }}"
     {{- end }}
     imagePullPolicy: {{ .Values.downloadDashboardsImage.pullPolicy }}
     command: ["/bin/sh"]
     args: [ "-c", "mkdir -p /var/lib/grafana/dashboards/default && /bin/sh -x /etc/grafana/download_dashboards.sh" ]
-    {{- with .Values.downloadDashboards.resources }}
     resources:
-      {{- toYaml . | nindent 6 }}
-    {{- end }}
+{{ toYaml .Values.downloadDashboards.resources | indent 6 }}
     env:
 {{- range $key, $value := .Values.downloadDashboards.env }}
       - name: "{{ $key }}"
         value: "{{ $value }}"
 {{- end }}
-    {{- with .Values.downloadDashboards.securityContext }}
-    securityContext:
-      {{- toYaml . | nindent 6 }}
-    {{- end }}
 {{- if .Values.downloadDashboards.envFromSecret }}
     envFrom:
       - secretRef:
@@ -87,20 +79,17 @@
 {{- if and .Values.sidecar.datasources.enabled .Values.sidecar.datasources.initDatasources }}
   - name: {{ template "grafana.name" . }}-init-sc-datasources
     {{- if .Values.sidecar.image.sha }}
-    image: "{{ .Values.sidecar.image.repository }}:{{ .Values.sidecar.image.tag }}@sha256:{{ .Values.sidecar.image.sha }}"
+    image: "{{ template "system_default_registry" . }}{{ .Values.sidecar.image.repository }}:{{ .Values.sidecar.image.tag }}@sha256:{{ .Values.sidecar.image.sha }}"
     {{- else }}
-    image: "{{ .Values.sidecar.image.repository }}:{{ .Values.sidecar.image.tag }}"
+    image: "{{ template "system_default_registry" . }}{{ .Values.sidecar.image.repository }}:{{ .Values.sidecar.image.tag }}"
     {{- end }}
     imagePullPolicy: {{ .Values.sidecar.imagePullPolicy }}
+    {{- if .Values.sidecar.datasources.envFromSecret }}
+    envFrom:
+      - secretRef:
+          name: {{ tpl .Values.sidecar.datasources.envFromSecret . }}
+    {{- end }}
     env:
-      {{- range $key, $value := .Values.sidecar.datasources.env }}
-      - name: "{{ $key }}"
-        value: "{{ $value }}"
-      {{- end }}
-      {{- if .Values.sidecar.datasources.ignoreAlreadyProcessed }}
-      - name: IGNORE_ALREADY_PROCESSED
-        value: "true"
-      {{- end }}
       - name: METHOD
         value: "LIST"
       - name: LABEL
@@ -109,10 +98,6 @@
       - name: LABEL_VALUE
         value: {{ quote .Values.sidecar.datasources.labelValue }}
       {{- end }}
-      {{- if or .Values.sidecar.logLevel .Values.sidecar.datasources.logLevel }}
-      - name: LOG_LEVEL
-        value: {{ default .Values.sidecar.logLevel .Values.sidecar.datasources.logLevel }}
-      {{- end }}
       - name: FOLDER
         value: "/etc/grafana/provisioning/datasources"
       - name: RESOURCE
@@ -123,20 +108,18 @@
       {{- end }}
       {{- if .Values.sidecar.datasources.searchNamespace }}
       - name: NAMESPACE
-        value: "{{ tpl (.Values.sidecar.datasources.searchNamespace | join ",") . }}"
+        value: "{{ .Values.sidecar.datasources.searchNamespace | join "," }}"
       {{- end }}
       {{- if .Values.sidecar.skipTlsVerify }}
       - name: SKIP_TLS_VERIFY
         value: "{{ .Values.sidecar.skipTlsVerify }}"
       {{- end }}
-    {{- with .Values.sidecar.resources }}
     resources:
-      {{- toYaml . | nindent 6 }}
-    {{- end }}
-    {{- with .Values.sidecar.securityContext }}
+{{ toYaml .Values.sidecar.resources | indent 6 }}
+{{- if .Values.sidecar.securityContext }}
     securityContext:
-      {{- toYaml . | nindent 6 }}
-    {{- end }}
+{{- toYaml .Values.sidecar.securityContext | nindent 6 }}
+{{- end }}
     volumeMounts:
       - name: sc-datasources-volume
         mountPath: "/etc/grafana/provisioning/datasources"
@@ -144,32 +127,16 @@
 {{- if .Values.sidecar.notifiers.enabled }}
   - name: {{ template "grafana.name" . }}-sc-notifiers
     {{- if .Values.sidecar.image.sha }}
-    image: "{{ .Values.sidecar.image.repository }}:{{ .Values.sidecar.image.tag }}@sha256:{{ .Values.sidecar.image.sha }}"
+    image: "{{ template "system_default_registry" . }}{{ .Values.sidecar.image.repository }}:{{ .Values.sidecar.image.tag }}@sha256:{{ .Values.sidecar.image.sha }}"
     {{- else }}
-    image: "{{ .Values.sidecar.image.repository }}:{{ .Values.sidecar.image.tag }}"
+    image: "{{ template "system_default_registry" . }}{{ .Values.sidecar.image.repository }}:{{ .Values.sidecar.image.tag }}"
     {{- end }}
     imagePullPolicy: {{ .Values.sidecar.imagePullPolicy }}
     env:
-      {{- range $key, $value := .Values.sidecar.notifiers.env }}
-      - name: "{{ $key }}"
-        value: "{{ $value }}"
-      {{- end }}
-      {{- if .Values.sidecar.notifiers.ignoreAlreadyProcessed }}
-      - name: IGNORE_ALREADY_PROCESSED
-        value: "true"
-      {{- end }}
       - name: METHOD
         value: LIST
       - name: LABEL
         value: "{{ .Values.sidecar.notifiers.label }}"
-      {{- if .Values.sidecar.notifiers.labelValue }}
-      - name: LABEL_VALUE
-        value: {{ quote .Values.sidecar.notifiers.labelValue }}
-      {{- end }}
-      {{- if or .Values.sidecar.logLevel .Values.sidecar.notifiers.logLevel }}
-      - name: LOG_LEVEL
-        value: {{ default .Values.sidecar.logLevel .Values.sidecar.notifiers.logLevel }}
-      {{- end }}
       - name: FOLDER
         value: "/etc/grafana/provisioning/notifiers"
       - name: RESOURCE
@@ -180,28 +147,26 @@
       {{- end }}
       {{- if .Values.sidecar.notifiers.searchNamespace }}
       - name: NAMESPACE
-        value: "{{ tpl (.Values.sidecar.notifiers.searchNamespace | join ",") . }}"
+        value: "{{ .Values.sidecar.notifiers.searchNamespace | join "," }}"
       {{- end }}
       {{- if .Values.sidecar.skipTlsVerify }}
       - name: SKIP_TLS_VERIFY
         value: "{{ .Values.sidecar.skipTlsVerify }}"
       {{- end }}
-    {{- with .Values.sidecar.livenessProbe }}
+{{- if .Values.sidecar.livenessProbe }}
     livenessProbe:
-      {{- toYaml . | nindent 6 }}
-    {{- end }}
-    {{- with .Values.sidecar.readinessProbe }}
+{{ toYaml .Values.livenessProbe | indent 6 }}
+{{- end }}
+{{- if .Values.sidecar.readinessProbe }}
     readinessProbe:
-      {{- toYaml . | nindent 6 }}
-    {{- end }}
-    {{- with .Values.sidecar.resources }}
+{{ toYaml .Values.readinessProbe | indent 6 }}
+{{- end }}
     resources:
-      {{- toYaml . | nindent 6 }}
-    {{- end }}
-    {{- with .Values.sidecar.securityContext }}
+{{ toYaml .Values.sidecar.resources | indent 6 }}
+{{- if .Values.sidecar.securityContext }}
     securityContext:
-      {{- toYaml . | nindent 6 }}
-    {{- end }}
+{{- toYaml .Values.sidecar.securityContext | nindent 6 }}
+{{- end }}
     volumeMounts:
       - name: sc-notifiers-volume
         mountPath: "/etc/grafana/provisioning/notifiers"
@@ -223,20 +188,12 @@
 {{- if .Values.sidecar.dashboards.enabled }}
   - name: {{ template "grafana.name" . }}-sc-dashboard
     {{- if .Values.sidecar.image.sha }}
-    image: "{{ .Values.sidecar.image.repository }}:{{ .Values.sidecar.image.tag }}@sha256:{{ .Values.sidecar.image.sha }}"
+    image: "{{ template "system_default_registry" . }}{{ .Values.sidecar.image.repository }}:{{ .Values.sidecar.image.tag }}@sha256:{{ .Values.sidecar.image.sha }}"
     {{- else }}
-    image: "{{ .Values.sidecar.image.repository }}:{{ .Values.sidecar.image.tag }}"
+    image: "{{ template "system_default_registry" . }}{{ .Values.sidecar.image.repository }}:{{ .Values.sidecar.image.tag }}"
     {{- end }}
     imagePullPolicy: {{ .Values.sidecar.imagePullPolicy }}
     env:
-      {{- range $key, $value := .Values.sidecar.dashboards.env }}
-      - name: "{{ $key }}"
-        value: "{{ $value }}"
-      {{- end }}
-      {{- if .Values.sidecar.dashboards.ignoreAlreadyProcessed }}
-      - name: IGNORE_ALREADY_PROCESSED
-        value: "true"
-      {{- end }}
       - name: METHOD
         value: {{ .Values.sidecar.dashboards.watchMethod }}
       - name: LABEL
@@ -245,10 +202,6 @@
       - name: LABEL_VALUE
         value: {{ quote .Values.sidecar.dashboards.labelValue }}
       {{- end }}
-      {{- if or .Values.sidecar.logLevel .Values.sidecar.dashboards.logLevel }}
-      - name: LOG_LEVEL
-        value: {{ default .Values.sidecar.logLevel .Values.sidecar.dashboards.logLevel }}
-      {{- end }}
       - name: FOLDER
         value: "{{ .Values.sidecar.dashboards.folder }}{{- with .Values.sidecar.dashboards.defaultFolderName }}/{{ . }}{{- end }}"
       - name: RESOURCE
@@ -259,7 +212,7 @@
       {{- end }}
       {{- if .Values.sidecar.dashboards.searchNamespace }}
       - name: NAMESPACE
-        value: "{{ tpl (.Values.sidecar.dashboards.searchNamespace | join ",") . }}"
+        value: "{{ .Values.sidecar.dashboards.searchNamespace | join "," }}"
       {{- end }}
       {{- if .Values.sidecar.skipTlsVerify }}
       - name: SKIP_TLS_VERIFY
@@ -274,35 +227,27 @@
         value: "{{ .Values.sidecar.dashboards.script }}"
       {{- end }}
       {{- if .Values.sidecar.dashboards.watchServerTimeout }}
-      {{- if ne .Values.sidecar.dashboards.watchMethod "WATCH" }}
-        {{- fail (printf "Cannot use .Values.sidecar.dashboards.watchServerTimeout with .Values.sidecar.dashboards.watchMethod %s" .Values.sidecar.dashboards.watchMethod) }}
-      {{- end }}
       - name: WATCH_SERVER_TIMEOUT
         value: "{{ .Values.sidecar.dashboards.watchServerTimeout }}"
       {{- end }}
       {{- if .Values.sidecar.dashboards.watchClientTimeout }}
-      {{- if ne .Values.sidecar.dashboards.watchMethod "WATCH" }}
-        {{- fail (printf "Cannot use .Values.sidecar.dashboards.watchClientTimeout with .Values.sidecar.dashboards.watchMethod %s" .Values.sidecar.dashboards.watchMethod) }}
-      {{- end }}
       - name: WATCH_CLIENT_TIMEOUT
         value: "{{ .Values.sidecar.dashboards.watchClientTimeout }}"
       {{- end }}
-    {{- with .Values.sidecar.livenessProbe }}
+{{- if .Values.sidecar.livenessProbe }}
     livenessProbe:
-      {{- toYaml . | nindent 6 }}
-    {{- end }}
-    {{- with .Values.sidecar.readinessProbe }}
+{{ toYaml .Values.livenessProbe | indent 6 }}
+{{- end }}
+{{- if .Values.sidecar.readinessProbe }}
     readinessProbe:
-      {{- toYaml . | nindent 6 }}
-    {{- end }}
-    {{- with .Values.sidecar.resources }}
+{{ toYaml .Values.readinessProbe | indent 6 }}
+{{- end }}
     resources:
-      {{- toYaml . | nindent 6 }}
-    {{- end }}
-    {{- with .Values.sidecar.securityContext }}
+{{ toYaml .Values.sidecar.resources | indent 6 }}
+{{- if .Values.sidecar.securityContext }}
     securityContext:
-      {{- toYaml . | nindent 6 }}
-    {{- end }}
+{{- toYaml .Values.sidecar.securityContext | nindent 6 }}
+{{- end }}
     volumeMounts:
       - name: sc-dashboard-volume
         mountPath: {{ .Values.sidecar.dashboards.folder | quote }}
@@ -313,20 +258,12 @@
 {{- if .Values.sidecar.datasources.enabled }}
   - name: {{ template "grafana.name" . }}-sc-datasources
     {{- if .Values.sidecar.image.sha }}
-    image: "{{ .Values.sidecar.image.repository }}:{{ .Values.sidecar.image.tag }}@sha256:{{ .Values.sidecar.image.sha }}"
+    image: "{{ template "system_default_registry" . }}{{ .Values.sidecar.image.repository }}:{{ .Values.sidecar.image.tag }}@sha256:{{ .Values.sidecar.image.sha }}"
     {{- else }}
-    image: "{{ .Values.sidecar.image.repository }}:{{ .Values.sidecar.image.tag }}"
+    image: "{{ template "system_default_registry" . }}{{ .Values.sidecar.image.repository }}:{{ .Values.sidecar.image.tag }}"
     {{- end }}
     imagePullPolicy: {{ .Values.sidecar.imagePullPolicy }}
     env:
-      {{- range $key, $value := .Values.sidecar.datasources.env }}
-      - name: "{{ $key }}"
-        value: "{{ $value }}"
-      {{- end }}
-      {{- if .Values.sidecar.datasources.ignoreAlreadyProcessed }}
-      - name: IGNORE_ALREADY_PROCESSED
-        value: "true"
-      {{- end }}
       - name: METHOD
         value: {{ .Values.sidecar.datasources.watchMethod }}
       - name: LABEL
@@ -335,10 +272,6 @@
       - name: LABEL_VALUE
         value: {{ quote .Values.sidecar.datasources.labelValue }}
       {{- end }}
-      {{- if or .Values.sidecar.logLevel .Values.sidecar.datasources.logLevel }}
-      - name: LOG_LEVEL
-        value: {{ default .Values.sidecar.logLevel .Values.sidecar.datasources.logLevel }}
-      {{- end }}
       - name: FOLDER
         value: "/etc/grafana/provisioning/datasources"
       - name: RESOURCE
@@ -349,16 +282,12 @@
       {{- end }}
       {{- if .Values.sidecar.datasources.searchNamespace }}
       - name: NAMESPACE
-        value: "{{ tpl (.Values.sidecar.datasources.searchNamespace | join ",") . }}"
+        value: "{{ .Values.sidecar.datasources.searchNamespace | join "," }}"
       {{- end }}
       {{- if .Values.sidecar.skipTlsVerify }}
       - name: SKIP_TLS_VERIFY
         value: "{{ .Values.sidecar.skipTlsVerify }}"
       {{- end }}
-      {{- if .Values.sidecar.datasources.script }}
-      - name: SCRIPT
-        value: "{{ .Values.sidecar.datasources.script }}"
-      {{- end }}
       {{- if and (not .Values.env.GF_SECURITY_ADMIN_USER) (not .Values.env.GF_SECURITY_DISABLE_INITIAL_ADMIN_CREATION) }}
       - name: REQ_USERNAME
         valueFrom:
@@ -379,36 +308,20 @@
       - name: REQ_METHOD
         value: POST
       {{- end }}
-      {{- if .Values.sidecar.datasources.watchServerTimeout }}
-      {{- if ne .Values.sidecar.datasources.watchMethod "WATCH" }}
-        {{- fail (printf "Cannot use .Values.sidecar.datasources.watchServerTimeout with .Values.sidecar.datasources.watchMethod %s" .Values.sidecar.datasources.watchMethod) }}
-      {{- end }}
-      - name: WATCH_SERVER_TIMEOUT
-        value: "{{ .Values.sidecar.datasources.watchServerTimeout }}"
-      {{- end }}
-      {{- if .Values.sidecar.datasources.watchClientTimeout }}
-      {{- if ne .Values.sidecar.datasources.watchMethod "WATCH" }}
-        {{- fail (printf "Cannot use .Values.sidecar.datasources.watchClientTimeout with .Values.sidecar.datasources.watchMethod %s" .Values.sidecar.datasources.watchMethod) }}
-      {{- end }}
-      - name: WATCH_CLIENT_TIMEOUT
-        value: "{{ .Values.sidecar.datasources.watchClientTimeout }}"
-      {{- end }}
-    {{- with .Values.sidecar.livenessProbe }}
+{{- if .Values.sidecar.livenessProbe }}
     livenessProbe:
-      {{- toYaml . | nindent 6 }}
-    {{- end }}
-    {{- with .Values.sidecar.readinessProbe }}
+{{ toYaml .Values.livenessProbe | indent 6 }}
+{{- end }}
+{{- if .Values.sidecar.readinessProbe }}
     readinessProbe:
-      {{- toYaml . | nindent 6 }}
-    {{- end }}
-    {{- with .Values.sidecar.resources }}
+{{ toYaml .Values.readinessProbe | indent 6 }}
+{{- end }}
     resources:
-      {{- toYaml . | nindent 6 }}
-    {{- end }}
-    {{- with .Values.sidecar.securityContext }}
+{{ toYaml .Values.sidecar.resources | indent 6 }}
+{{- if .Values.sidecar.securityContext }}
     securityContext:
-      {{- toYaml . | nindent 6 }}
-    {{- end }}
+{{- toYaml .Values.sidecar.securityContext | nindent 6 }}
+{{- end }}
     volumeMounts:
       - name: sc-datasources-volume
         mountPath: "/etc/grafana/provisioning/datasources"
@@ -416,20 +329,12 @@
 {{- if .Values.sidecar.plugins.enabled }}
   - name: {{ template "grafana.name" . }}-sc-plugins
     {{- if .Values.sidecar.image.sha }}
-    image: "{{ .Values.sidecar.image.repository }}:{{ .Values.sidecar.image.tag }}@sha256:{{ .Values.sidecar.image.sha }}"
+    image: "{{ template "system_default_registry" . }}{{ .Values.sidecar.image.repository }}:{{ .Values.sidecar.image.tag }}@sha256:{{ .Values.sidecar.image.sha }}"
     {{- else }}
-    image: "{{ .Values.sidecar.image.repository }}:{{ .Values.sidecar.image.tag }}"
+    image: "{{ template "system_default_registry" . }}{{ .Values.sidecar.image.repository }}:{{ .Values.sidecar.image.tag }}"
     {{- end }}
     imagePullPolicy: {{ .Values.sidecar.imagePullPolicy }}
     env:
-      {{- range $key, $value := .Values.sidecar.plugins.env }}
-      - name: "{{ $key }}"
-        value: "{{ $value }}"
-      {{- end }}
-      {{- if .Values.sidecar.plugins.ignoreAlreadyProcessed }}
-      - name: IGNORE_ALREADY_PROCESSED
-        value: "true"
-      {{- end }}
       - name: METHOD
         value: {{ .Values.sidecar.plugins.watchMethod }}
       - name: LABEL
@@ -438,10 +343,6 @@
       - name: LABEL_VALUE
         value: {{ quote .Values.sidecar.plugins.labelValue }}
       {{- end }}
-      {{- if or .Values.sidecar.logLevel .Values.sidecar.plugins.logLevel }}
-      - name: LOG_LEVEL
-        value: {{ default .Values.sidecar.logLevel .Values.sidecar.plugins.logLevel }}
-      {{- end }}
       - name: FOLDER
         value: "/etc/grafana/provisioning/plugins"
       - name: RESOURCE
@@ -452,11 +353,7 @@
       {{- end }}
       {{- if .Values.sidecar.plugins.searchNamespace }}
       - name: NAMESPACE
-        value: "{{ tpl (.Values.sidecar.plugins.searchNamespace | join ",") . }}"
-      {{- end }}
-      {{- if .Values.sidecar.plugins.script }}
-      - name: SCRIPT
-        value: "{{ .Values.sidecar.plugins.script }}"
+        value: "{{ .Values.sidecar.plugins.searchNamespace | join "," }}"
       {{- end }}
       {{- if .Values.sidecar.skipTlsVerify }}
       - name: SKIP_TLS_VERIFY
@@ -482,45 +379,29 @@
       - name: REQ_METHOD
         value: POST
       {{- end }}
-      {{- if .Values.sidecar.plugins.watchServerTimeout }}
-      {{- if ne .Values.sidecar.plugins.watchMethod "WATCH" }}
-        {{- fail (printf "Cannot use .Values.sidecar.plugins.watchServerTimeout with .Values.sidecar.plugins.watchMethod %s" .Values.sidecar.plugins.watchMethod) }}
-      {{- end }}
-      - name: WATCH_SERVER_TIMEOUT
-        value: "{{ .Values.sidecar.plugins.watchServerTimeout }}"
-      {{- end }}
-      {{- if .Values.sidecar.plugins.watchClientTimeout }}
-      {{- if ne .Values.sidecar.plugins.watchMethod "WATCH" }}
-        {{- fail (printf "Cannot use .Values.sidecar.plugins.watchClientTimeout with .Values.sidecar.plugins.watchMethod %s" .Values.sidecar.plugins.watchMethod) }}
-      {{- end }}
-      - name: WATCH_CLIENT_TIMEOUT
-        value: "{{ .Values.sidecar.plugins.watchClientTimeout }}"
-      {{- end }}
-    {{- with .Values.sidecar.livenessProbe }}
+{{- if .Values.sidecar.livenessProbe }}
     livenessProbe:
-      {{- toYaml . | nindent 6 }}
-    {{- end }}
-    {{- with .Values.sidecar.readinessProbe }}
+{{ toYaml .Values.livenessProbe | indent 6 }}
+{{- end }}
+{{- if .Values.sidecar.readinessProbe }}
     readinessProbe:
-      {{- toYaml . | nindent 6 }}
-    {{- end }}
-    {{- with .Values.sidecar.resources }}
+{{ toYaml .Values.readinessProbe | indent 6 }}
+{{- end }}
     resources:
-      {{- toYaml . | nindent 6 }}
-    {{- end }}
-    {{- with .Values.sidecar.securityContext }}
+{{ toYaml .Values.sidecar.resources | indent 6 }}
+{{- if .Values.sidecar.securityContext }}
     securityContext:
-      {{- toYaml . | nindent 6 }}
-    {{- end }}
+{{- toYaml .Values.sidecar.securityContext | nindent 6 }}
+{{- end }}
     volumeMounts:
       - name: sc-plugins-volume
         mountPath: "/etc/grafana/provisioning/plugins"
 {{- end}}
   - name: {{ .Chart.Name }}
     {{- if .Values.image.sha }}
-    image: "{{ .Values.image.repository }}:{{ .Values.image.tag | default .Chart.AppVersion }}@sha256:{{ .Values.image.sha }}"
+    image: "{{ template "system_default_registry" . }}{{ .Values.image.repository }}:{{ .Values.image.tag | default .Chart.AppVersion }}@sha256:{{ .Values.image.sha }}"
     {{- else }}
-    image: "{{ .Values.image.repository }}:{{ .Values.image.tag | default .Chart.AppVersion }}"
+    image: "{{ template "system_default_registry" . }}{{ .Values.image.repository }}:{{ .Values.image.tag | default .Chart.AppVersion }}"
     {{- end }}
     imagePullPolicy: {{ .Values.image.pullPolicy }}
   {{- if .Values.command }}
@@ -529,10 +410,10 @@
       - {{ . }}
     {{- end }}
   {{- end}}
-    {{- with .Values.containerSecurityContext }}
+{{- if .Values.containerSecurityContext }}
     securityContext:
-      {{- toYaml . | nindent 6 }}
-    {{- end }}
+{{- toYaml .Values.containerSecurityContext | nindent 6 }}
+{{- end }}
     volumeMounts:
       - name: config
         mountPath: "/etc/grafana/grafana.ini"
@@ -585,13 +466,6 @@
         subPath: {{ . | quote }}
 {{- end }}
 {{- end }}
-{{- if .Values.alerting }}
-{{- range (keys .Values.alerting | sortAlpha) }}
-      - name: config
-        mountPath: "/etc/grafana/provisioning/alerting/{{ . }}"
-        subPath: {{ . | quote }}
-{{- end }}
-{{- end }}
 {{- if .Values.dashboardProviders }}
 {{- range (keys .Values.dashboardProviders | sortAlpha) }}
       - name: config
@@ -637,9 +511,12 @@
         mountPath: {{ .mountPath }}
     {{- end }}
     ports:
-      - name: {{ .Values.podPortName }}
+      - name: {{ .Values.service.portName }}
         containerPort: {{ .Values.service.targetPort }}
         protocol: TCP
+      - name: {{ .Values.podPortName }}
+        containerPort: 3000
+        protocol: TCP
     env:
       {{- if and (not .Values.env.GF_SECURITY_ADMIN_USER) (not .Values.env.GF_SECURITY_DISABLE_INITIAL_ADMIN_CREATION) }}
       - name: GF_SECURITY_ADMIN_USER
@@ -718,40 +595,30 @@
           optional: {{ .optional | default false }}
     {{- end }}
     {{- end }}
-    {{- with .Values.livenessProbe }}
     livenessProbe:
-      {{- toYaml . | nindent 6 }}
-    {{- end }}
-    {{- with .Values.readinessProbe }}
+{{ toYaml .Values.livenessProbe | indent 6 }}
     readinessProbe:
-      {{- toYaml . | nindent 6 }}
-    {{- end }}
+{{ toYaml .Values.readinessProbe | indent 6 }}
 {{- if .Values.lifecycleHooks }}
     lifecycle: {{ tpl (.Values.lifecycleHooks | toYaml) . | nindent 6 }}
 {{- end }}
-    {{- with .Values.resources }}
     resources:
-      {{- toYaml . | nindent 6 }}
-    {{- end }}
+{{ toYaml .Values.resources | indent 6 }}
 {{- with .Values.extraContainers }}
 {{ tpl . $ | indent 2 }}
 {{- end }}
-{{- with .Values.nodeSelector }}
-nodeSelector:
-  {{- toYaml . | nindent 2 }}
+nodeSelector: {{ include "linux-node-selector" . | nindent 2 }}
+{{- if .Values.nodeSelector }}
+{{ toYaml .Values.nodeSelector | indent 2 }}
 {{- end }}
 {{- $root := . }}
 {{- with .Values.affinity }}
 affinity:
 {{ tpl (toYaml .) $root | indent 2 }}
 {{- end }}
-{{- with .Values.topologySpreadConstraints }}
-topologySpreadConstraints:
-  {{- toYaml . | nindent 2 }}
-{{- end }}
-{{- with .Values.tolerations }}
-tolerations:
-  {{- toYaml . | nindent 2 }}
+tolerations: {{ include "linux-node-tolerations" . | nindent 2 }}
+{{- if .Values.tolerations }}
+{{ toYaml .Values.tolerations | indent 2 }}
 {{- end }}
 volumes:
   - name: config
@@ -762,9 +629,6 @@
   - name: {{ tpl .name $root }}
     configMap:
       name: {{ tpl .configMap $root }}
-      {{- if .items }}
-      items: {{ toYaml .items | nindent 6 }}
-      {{- end }}
 {{- end }}
   {{- if .Values.dashboards }}
     {{- range (keys .Values.dashboards | sortAlpha) }}
@@ -858,9 +722,6 @@
     secret:
       secretName: {{ .secretName }}
       defaultMode: {{ .defaultMode }}
-      {{- if .items }}
-      items: {{ toYaml .items | nindent 6 }}
-      {{- end }}
 {{- else if .projected }}
   - name: {{ .name }}
     projected: {{- toYaml .projected | nindent 6 }}
@@ -877,10 +738,6 @@
     {{- else if .hostPath }}
     hostPath:
       path: {{ .hostPath }}
-    {{- else if .csi }}
-    csi:
-      data:
-        {{ toYaml .data | nindent 6 }}
     {{- else }}
     emptyDir: {}
     {{- end }}
@@ -890,6 +747,6 @@
     emptyDir: {}
 {{- end -}}
 {{- if .Values.extraContainerVolumes }}
-{{ tpl (toYaml .Values.extraContainerVolumes) . | indent 2 }}
+{{ toYaml .Values.extraContainerVolumes | indent 2 }}
 {{- end }}
 {{- end }}
